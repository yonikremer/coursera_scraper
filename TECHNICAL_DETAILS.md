# Technical Details & Developer Guide

## How It Works

1. **Authentication**: Opens Chrome browser and navigates to Coursera login.
2. **Google Login**: You manually complete the entire Google login flow in the browser. Cookies are saved to `coursera_downloads/coursera_cookies.pkl` for persistent login.
3. **Certificate Navigation**: Extracts all course URLs from the professional certificate.
4. **Course Download**: For each course:
   - Iterates through modules (Module 1, 2, 3, etc.).
   - Extracts all item links from each module page.
   - Downloads each item sequentially:
     - Videos (MP4 in 720p quality)
     - PDFs and resources
     - Reading materials with attachments (saved as HTML)
     - Assignments and quizzes (saves content to HTML)
     - Jupyter Labs (downloads .ipynb notebook + all data files)
5. **Post-Processing** (Integrated):
   - **Compression**: Videos are compressed using NVENC (GPU) to save space.
   - **Translation**: Captions are translated to Hebrew using local Ollama models.
   - **Summarization**: Reading materials are summarized in Hebrew using local AI.
6. **Organization**: Creates folder structure with numbered files organized by module:
   ```
   coursera_downloads/
   ├── course-name-1/
   │   ├── Module_1/
   │   │   ├── 001_Introduction_to_Course.mp4
   │   │   ├── 002_Helpful_Resources.html
   │   │   ├── 003_Course_Overview_quiz.html
   │   │   └── 004_Python_Lab_lab/
   │   │       ├── notebook.ipynb
   │   │       ├── data.csv
   │   │       └── lab_info.txt
   │   ├── Module_2/
   │   └── ...
   ├── course-name-2/
   └── ...
   ```

## Navigation & UX Architecture

The system uses `create_course_navigator.py` to transform static files into a rich learning environment. This process is **fully integrated** into the main scraper.

### 1. Integration Workflow

- **Per-Course Generation**: The `CourseraScraper.get_course_content()` method automatically triggers navigation generation as soon as all modules for a course are downloaded.
- **Global Scan**: `main.py` performs a secondary global scan (`scan_and_generate`) at the end of execution to ensure all courses (including existing ones) are up to date.

### 2. HTML Injection Strategy

- **Readings**: The script parses existing `.html` files (quizzes, readings), strips previous wrappers, and injects a unified Sidebar Layout.
- **Videos**: Since MP4s cannot host HTML/JS, the script generates companion HTML wrappers (e.g., `001_Lecture.html`) that embed the video player + sidebar.

### 2. Smart Features Implementation

- **Auto-Advance**: A JavaScript event listener (`video.addEventListener('ended', ...)`) detects when a video finishes, finds the active sidebar item, and redirects the browser to the `href` of the next item.
- **State Persistence**: Playback preferences are saved to the browser's `localStorage` (`coursera_video_speed`, `coursera_video_volume`). A script restores these values immediately upon video load, ensuring consistent 2x speed across all courses.

### 3. Styling & Layout

- **Full-Width Layout**: Uses aggressive CSS overrides (`!important`) on the `body` and `#app-container` to break out of the original scraper's 900px width limit, utilizing the full screen.
- **RTL Support**: Specific CSS classes (`.ai-summary-box`) enforce `direction: rtl` for Hebrew content generated by the AI summarizer.

## Advanced Troubleshooting

### ChromeDriver Issues

```bash
# Linux/WSL
sudo apt-get install chromium-chromedriver

# macOS
brew install chromedriver

# Windows
Download from https://chromedriver.chromium.org/
```

### Login Timeout

If login times out, increase the timeout in `coursera/auth.py` (line 35):

```python
WebDriverWait(self.driver, 180)  # Change 180 to higher value
```

### Video Download Fails

- Ensure yt-dlp is up to date: `pip install --upgrade yt-dlp`
- Some videos may be protected and cannot be downloaded.

## Legal Notice

This tool is for personal use only. Ensure you comply with Coursera's Terms of Service. Downloaded materials should only be used for your personal educational purposes and not redistributed.
